# AI RPG 测试系统

一个基于 OpenAI API 的交互式角色扮演对话系统，用于测试和演示 AI 驱动的故事生成和 NPC 对话功能。

---

## ⚠️ 重要提示：启动方式

**请勿直接双击打开 HTML 文件！** 这会导致 CORS 跨域错误。

### 正确的启动方式：

**Windows：** 双击 `启动服务器.bat`  
**Mac/Linux：** 运行 `python3 proxy_server.py`  
**其他：** 查看 `CORS问题解决方案.md`

📖 **详细解决方案请查看：`CORS问题解决方案.md`**

---

## 功能特点

### 三大核心模块

1. **对话模块（Module 1）** ⭐ 带记忆功能
   - 控制 NPC 根据场景背景和玩家输入进行对话
   - ✨ **AI 会记住之前的对话内容**（最近10轮），保持连贯性
   - AI 智能判断让几个 NPC 回应（1个、2个或更多），符合实际语境
   - 包含情绪动画系统（高兴、难过、失望、振奋、绝望、疯狂、希望、平静）

2. **总结模块（Module 2）**
   - 自动总结当前场景的故事发展
   - 基于故事背景、NPC 目标和完整聊天记录生成总结

3. **故事模块（Module 3）**
   - 根据前一幕的故事和互动生成下一幕内容
   - 自动生成主要 NPC 的初始对话和动作

### 工作流程

```
配置页 → 场景初始化 → 对话循环 → 结束对话 → 
生成总结 → 生成下一幕故事 → 下一幕（循环）
```

## 使用方法

### 1. 配置页面

1. 输入你的 **OpenAI API Key**
2. 选择要使用的 **AI 模型**（推荐 GPT-4o 或 GPT-4o-mini）
3. 为三个模块配置 **System Prompt**（已提供默认配置）
4. 根据需要选择是否启用 **JSON Mode**
5. 点击 **"开始"** 按钮

### 2. 场景初始化

1. **故事的总结**：输入当前故事的背景和已发生的事件
2. **NPC 的 List**：列出本场景中的 NPC（例如：张三、李四、王五）
3. **NPC 的 Goal**：描述 NPC 在这一幕中的目标和动机
4. 点击 **"开始对话"** 按钮

### 3. 对话场景

- 在输入框中输入玩家的对话内容
- 点击 **"发送"** 按钮或按 **Enter** 键发送
- NPC 会根据 AI 的判断进行回应，显示 NPC 名字、对话内容和情绪
- 对话历史会显示在聊天窗口中
- 完成对话后，点击 **"结束对话"** 按钮

### 4. 总结与下一幕

- 系统会自动调用总结模块，生成当前场景的故事总结
- 然后调用故事模块，生成下一幕的场景描述和 NPC 初始对话
- 查看生成的内容后，点击 **"下一幕"** 按钮继续新的场景
- 或点击 **"返回配置"** 按钮重新开始

## 技术架构

- **前端**：HTML5 + CSS3 + Vanilla JavaScript
- **API**：OpenAI Chat Completions API
- **架构**：单页应用（SPA）

## 文件结构

```
D:\测试\
├── index.html      # 主 HTML 文件
├── style.css       # 样式文件
├── app.js          # JavaScript 逻辑
└── README.md       # 说明文档
```

## 配置建议

### 模型选择

- **GPT-4o**：最强性能，适合复杂的角色扮演和故事生成
- **GPT-4o-mini**：性价比高，响应快速，适合大部分场景
- **GPT-4 Turbo**：平衡性能和成本
- **GPT-3.5 Turbo**：成本最低，适合简单对话

### System Prompt 示例

#### 对话模块
```
你是一个资深的游戏DM（Dungeon Master），负责控制NPC的对话和行为。
根据故事背景、NPC列表和目标，以及玩家的输入，指挥NPC进行对话。

重要原则：
- 根据语境判断应该让几个NPC回应（可以是1个、2个或更多）
- 不是所有NPC都必须每次说话，要符合实际情况
- 如果玩家只对某个NPC说话，通常只需要那个NPC回应
- 如果是群体对话或引发争论，可以多个NPC回应

返回格式：每个回应的NPC都要包括NPC名字、说话内容、情绪动画
（从以下选择：高兴、难过、失望、振奋、绝望、疯狂、希望、平静）。
```

#### 总结模块
```
你是一个故事总结专家。根据故事背景、NPC目标和玩家与NPC的聊天记录，
总结当前场景的故事发展。

请提供一个简洁但全面的总结，包括关键事件、角色发展和重要决策。
```

#### 故事模块
```
你是一个创意故事作家。根据上一幕的故事总结、NPC列表和他们的目标，
续写下一幕发生的事情。

请生成：
1. 下一幕的场景描述和发生的事件
2. 一个主要NPC的初始对话（包括NPC名字、对话内容、动作描述）
```

### JSON Mode

启用 JSON Mode 可以获得更结构化的输出，便于程序解析。

#### 对话模块 JSON 格式
```json
{
  "responses": [
    {
      "npc_name": "张三",
      "content": "欢迎来到我的店铺！",
      "emotion": "高兴"
    }
  ]
}
```

#### 故事模块 JSON 格式
```json
{
  "scene_description": "夜幕降临，城镇广场上人群渐渐散去...",
  "npc_dialogue": {
    "npc_name": "李四",
    "content": "你终于来了，我等你很久了。",
    "action": "从阴影中走出，表情严肃"
  }
}
```

## 注意事项

1. **API Key 安全**：请妥善保管你的 OpenAI API Key，不要分享给他人
2. **费用控制**：使用 GPT-4 系列模型会产生费用，建议先用 GPT-4o-mini 测试
3. **响应时间**：根据模型和提示词的复杂度，响应时间可能需要几秒到十几秒
4. **浏览器兼容性**：建议使用现代浏览器（Chrome、Edge、Firefox、Safari）

## 使用场景

- **游戏开发测试**：测试 AI 驱动的 NPC 对话系统
- **故事创作辅助**：用 AI 协助构建交互式故事
- **教育演示**：展示 AI 在交互式叙事中的应用
- **原型开发**：快速验证 AI 对话系统的可行性

## 开始使用

1. 在浏览器中打开 `index.html`
2. 输入你的 OpenAI API Key
3. 选择合适的模型
4. 配置三个模块的 System Prompt（可使用默认配置）
5. 点击"开始"开始你的 AI RPG 之旅！

## 问题排查

### API 调用失败
- 检查 API Key 是否正确
- 确认账户有足够的额度
- 检查网络连接是否正常

### 响应格式不正确
- 尝试调整 System Prompt 中的格式说明
- 考虑启用 JSON Mode 获得更稳定的输出
- 检查模型是否支持你使用的功能

### 响应速度慢
- 尝试使用更快的模型（如 GPT-4o-mini）
- 简化 System Prompt 和场景描述
- 减少对话历史的长度

## 许可

本项目仅用于测试和学习目的。

---

**享受你的 AI RPG 冒险！** 🎮✨


================================================================
        快速测试 v2.1 新功能
         NPC 初始对话功能
================================================================

【测试目标】
  体验 NPC 主动问候玩家和故事生成的开场白

================================================================
【第一幕 - NPC 主动问候】
================================================================

1. 启动服务器
   双击 "启动服务器.bat" (Windows)
   或运行 python3 proxy_server.py (Mac/Linux)

2. 配置 API 和 System Prompts
   API Key: 输入你的 OpenAI API Key
   模型: gpt-4o-mini
   (保持默认的 System Prompts)

3. 点击"开始"

4. 填写场景信息（第一幕）
   
   故事背景：
   你刚刚踏入"金色狮子"酒馆，这是一个冒险者聚集的地方。
   酒馆里充满了欢声笑语，各种传奇故事在这里流传。
   
   NPC列表：
   老板娘玛丽、战士杰克、法师露娜
   
   NPC目标：
   老板娘想招待好每一位客人，杰克在寻找队友，
   露娜在寻找一本失落的魔法书。

5. 点击"开始对话"

6. ⭐ 观察：NPC 会主动问候你！
   
   预期效果：
   NPC（如老板娘玛丽）会主动说类似：
   "欢迎光临金色狮子！第一次来这里吗？"
   
   ✅ 说明新功能生效了！

7. 继续对话
   
   示例回复：
   "你好！我是新来的冒险者，想找点任务做。"
   
   （NPC 会根据对话内容智能回应）

8. 对话几轮后，点击"结束对话"

================================================================
【第二幕 - 故事生成的开场白】
================================================================

9. 等待总结和故事生成
   
   系统会：
   - 总结第一幕的故事
   - 生成下一幕的场景
   - ⭐ 生成 NPC 的初始对话（包含情绪）

10. 观察"下一幕故事"部分
    
    你会看到：
    - 场景描述：下一幕发生了什么
    - NPC初始对话：某个NPC的开场白（带情绪）
    
    示例：
    【场景描述】
    你们踏上了前往黑暗森林的道路...
    
    【NPC初始对话】
    [战士杰克] 准备好了吗？前面可能很危险。 [情绪：平静]

11. 点击"下一幕"

12. ⭐ 观察：NPC 的开场白会自动显示！
    
    预期效果：
    进入对话页面后，你会立即看到：
    [战士杰克] 准备好了吗？前面可能很危险。 [情绪：平静]
    
    ✅ 说明新功能生效了！

13. 继续对话
    
    示例回复：
    "我准备好了！我们一起进去吧。"

================================================================
【对比测试：之前 vs 现在】
================================================================

之前的体验：
  第一幕：进入场景 → 玩家先说话
  第二幕：进入场景 → 玩家先说话

现在的体验：
  第一幕：进入场景 → NPC 主动问候 ⭐ 更自然
  第二幕：进入场景 → 显示故事生成的开场白 ⭐ 更流畅

================================================================
【测试要点】
================================================================

✅ 第一幕开始时，NPC 是否主动问候？
✅ 问候内容是否与故事背景相关？
✅ 结束对话后，故事模块是否生成 NPC 初始对话？
✅ 第二幕开始时，是否自动显示 NPC 开场白？
✅ NPC 对话是否包含情绪动画？
✅ 对话是否连贯（记忆功能）？

================================================================
【调试技巧】
================================================================

打开浏览器控制台（F12）查看日志：

1. 配置保存时：
   应该看到：
   "配置已保存："
   "对话模块 System Prompt: ..."

2. 生成初始问候时：
   应该看到：
   "🤖 调用 OpenAI API"
   "📝 System Prompt: ..."

3. 对话时：
   应该看到：
   "💬 包含历史记录，共 X 条消息"

================================================================
【常见问题】
================================================================

Q: NPC 没有主动问候？
A: 检查控制台是否有错误，确认 API Key 正确

Q: 第二幕没有显示开场白？
A: 检查故事模块是否生成了 NPC 对话（查看总结页面）

Q: 情绪动画没有显示？
A: 这是预期的，情绪主要供前端识别，可用于后续扩展

================================================================
【体验建议】
================================================================

尝试不同的场景类型：
  - 🏰 奇幻冒险：酒馆、地下城
  - 👑 宫廷剧：王宫阴谋
  - 🚀 科幻：空间站、未来世界
  - 🔍 推理：侦探事务所

观察 AI 如何：
  - 选择合适的 NPC 问候
  - 生成符合场景的开场白
  - 根据情节推进选择主要 NPC

================================================================
【完整测试流程总结】
================================================================

第一幕：
  配置 → 填写场景 → [NPC 主动问候] ⭐ → 对话 → 结束

第二幕：
  查看故事 → [看到 NPC 开场白生成] ⭐ → 点击下一幕 
  → [开场白自动显示] ⭐ → 对话 → 结束

第三幕：
  （重复第二幕的流程）

================================================================

开始测试吧！体验更沉浸的 AI RPG！🎮✨

================================================================


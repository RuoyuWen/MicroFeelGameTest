# System Prompt 配置说明

## ❗ 重要提示

**System Prompt 必须在配置页面设置并点击"开始"按钮后才会生效！**

---

## 📝 正确的配置流程

### 第一步：在配置页面设置

1. 打开系统，进入配置页面
2. 输入 OpenAI API Key
3. 选择模型
4. **修改三个模块的 System Prompt**
   - Module 1：对话模块
   - Module 2：总结模块
   - Module 3：故事模块
5. 选择是否启用 JSON Mode
6. **点击"开始"按钮** ⭐ 重要！

### 第二步：验证配置已保存

点击"开始"后，打开浏览器控制台（按 F12），应该看到：

```
配置已保存：
对话模块 System Prompt: 你是一个资深的游戏DM（Dungeon Master），负责...
总结模块 System Prompt: 你是一个故事总结专家。根据故事背景、NPC目标...
故事模块 System Prompt: 你是一个创意故事作家。根据上一幕的故事总结...
```

✅ 如果看到这个，说明配置已保存成功！

---

## 🔍 如何验证 System Prompt 生效

### 方法 1：查看控制台日志

每次 AI 调用时，控制台会显示：

```
🤖 调用 OpenAI API
📝 System Prompt: 你是一个资深的游戏DM（Dungeon Master）...
💬 包含历史记录，共 4 条消息
```

**检查点：**
- ✅ System Prompt 的内容是否是你设置的
- ✅ 不是默认的 Prompt

### 方法 2：测试 AI 行为

**测试步骤：**

1. 修改对话模块的 System Prompt，例如：
```
你是一个幽默风趣的 DM，所有 NPC 都喜欢开玩笑。
每个回应都要包含一个笑话或双关语。

返回格式：[NPC名字] 说话内容 [情绪：情绪动画]
```

2. 点击"开始"保存配置

3. 开始对话，观察 NPC 是否真的变得幽默风趣

✅ 如果 NPC 行为改变了，说明 System Prompt 生效了！

---

## 🚨 常见问题

### 问题 1：修改了 System Prompt 但没有效果

**原因：** 没有点击"开始"按钮保存配置

**解决方案：**
1. 返回配置页面（点击"返回配置"）
2. 修改 System Prompt
3. **必须点击"开始"按钮**
4. 重新开始对话

### 问题 2：不确定当前使用的是哪个 System Prompt

**解决方案：**
1. 按 F12 打开浏览器控制台
2. 切换到 Console 标签
3. 查看每次 AI 调用时显示的 System Prompt
4. 对比你设置的内容

### 问题 3：想要中途修改 System Prompt

**解决方案：**
1. 点击页面上的"返回配置"按钮
2. 修改 System Prompt
3. 点击"开始"
4. 重新配置场景
5. 继续使用

⚠️ **注意：** 返回配置会清空当前对话历史！

---

## 💡 System Prompt 最佳实践

### 对话模块

**好的 System Prompt：**
```
你是一个专业的游戏 DM，负责控制 NPC。

角色原则：
- 每个 NPC 有独特的性格和说话方式
- 记住对话历史，保持一致性
- 根据 NPC 目标行动
- 智能判断谁应该回应

情绪表达：
- 根据对话内容选择合适的情绪
- 情绪要符合角色性格
- 8种情绪：高兴、难过、失望、振奋、绝望、疯狂、希望、平静

返回格式：[NPC名字] 说话内容 [情绪：情绪名称]
```

**避免的 System Prompt：**
```
你是一个 NPC。说话。
```
❌ 太简单，缺乏指导

### 总结模块

**好的 System Prompt：**
```
你是一个专业的故事分析师。

任务：根据聊天记录总结场景发展

总结应包括：
- 关键事件和转折点
- 角色关系的变化
- 重要的承诺或决定
- 未解决的悬念

风格：简洁但全面，突出重点
```

### 故事模块

**好的 System Prompt：**
```
你是一个创意故事作家。

任务：续写下一幕的故事

续写原则：
- 自然承接上一幕
- 保持故事连贯性
- 引入新的元素或挑战
- 不要跳跃太大

输出格式：
1. 场景描述（环境、氛围、发生的事）
2. 主要 NPC 的初始对话（包括动作）
```

---

## 🎯 测试 System Prompt 的技巧

### 测试 1：风格测试

**设置不同风格的 System Prompt：**

**风格 A：严肃正经**
```
你是一个严肃的 DM，所有 NPC 都很正式，用词专业。
```

**风格 B：轻松幽默**
```
你是一个幽默的 DM，所有 NPC 都喜欢开玩笑。
```

**对比 AI 回应**，看风格是否改变。

### 测试 2：角色性格测试

**设置具体的角色性格：**
```
NPC 性格设定：
- 老板：贪财，精明，说话直接
- 战士：粗犷，豪爽，喜欢战斗
- 法师：高傲，知识渊博，说话文绉绉
```

**观察 NPC 回应**是否符合设定。

### 测试 3：格式测试

**设置不同的返回格式：**

**格式 A：简单格式**
```
返回格式：NPC名字：对话内容
```

**格式 B：详细格式**
```
返回格式：
【NPC：xxx】
对话："xxx"
动作：xxx
情绪：xxx
```

**查看 AI 输出**是否符合格式。

---

## 📊 调试信息说明

### 配置保存时的日志

```
配置已保存：
对话模块 System Prompt: 你是一个资深的游戏DM（Dun...
总结模块 System Prompt: 你是一个故事总结专家。根据...
故事模块 System Prompt: 你是一个创意故事作家。根据...
```

**说明：** 显示前 50 个字符，确认配置已保存

### API 调用时的日志

```
🤖 调用 OpenAI API
📝 System Prompt: 你是一个资深的游戏DM（Dun...
💬 包含历史记录，共 6 条消息
```

**说明：**
- 🤖 表示开始调用 API
- 📝 显示使用的 System Prompt（前 100 字符）
- 💬 显示历史消息数量（仅对话模块）

---

## ✅ 快速检查清单

在使用前，确认以下步骤：

- [ ] 在配置页面修改了 System Prompt
- [ ] 点击了"开始"按钮
- [ ] 看到了"配置已保存"的控制台日志
- [ ] 开始对话前打开了控制台（F12）
- [ ] 发送消息时看到了"调用 OpenAI API"的日志
- [ ] 确认日志中的 System Prompt 是自己设置的

全部打勾 ✅ = System Prompt 已正确配置！

---

## 🎉 总结

**关键点：**

1. ⭐ **必须点击"开始"按钮**才能保存配置
2. 🔍 **使用浏览器控制台**验证配置
3. 🧪 **通过测试 AI 行为**确认效果
4. 🔄 **想修改需要返回配置页面**重新设置

**现在你知道如何正确配置和验证 System Prompt 了！** ✨

如果还有疑问，打开浏览器控制台（F12），查看详细的调试信息。


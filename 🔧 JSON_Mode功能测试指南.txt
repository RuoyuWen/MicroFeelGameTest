================================================
🔧 JSON Mode 自动提示功能测试指南
================================================

如果功能没有生效，请按照以下步骤排查：

================================================
📋 测试步骤
================================================

【步骤1】打开系统并打开控制台
  1. 用浏览器打开 index.html
  2. 按 F12 打开浏览器开发者工具
  3. 切换到 "Console" (控制台) 标签

【步骤2】检查初始化日志
  在控制台中，你应该看到：
  
  ┌─────────────────────────────────────────┐
  │ ✅ 从 localStorage 加载玩家记忆         │
  │ 🔧 正在初始化 JSON Mode 自动提示...    │
  │ ✅ 已绑定 JSON Mode 自动提示:          │
  │    module1-prompt ↔ module1-json       │
  │ ✅ 已绑定 JSON Mode 自动提示:          │
  │    module2-prompt ↔ module2-json       │
  │ ✅ 已绑定 JSON Mode 自动提示:          │
  │    module3-prompt ↔ module3-json       │
  │ ✅ JSON Mode 自动提示已启用            │
  │ AI RPG 测试系统已加载                   │
  │ 🧠 玩家记忆系统已启用                  │
  └─────────────────────────────────────────┘

  ✅ 如果看到这些日志 → 初始化成功！
  ❌ 如果看到错误 → 继续看步骤3

【步骤3】测试勾选功能
  1. 在配置页面找到任一模块（如 Module 1）
  2. 查看 System Prompt 的当前内容
  3. 勾选 "☑ 启用 JSON Mode"
  4. 观察控制台输出：
  
  期待看到：
  ┌─────────────────────────────────────────┐
  │ 📝 module1-json 状态变更: 勾选         │
  │ 📄 当前 Prompt 长度: XXX 字符          │
  │ ✅ 已添加 JSON Mode 提示到             │
  │    module1-prompt                      │
  │ 📄 更新后 Prompt 长度: XXX 字符        │
  └─────────────────────────────────────────┘

  5. 向下滚动 System Prompt 的 textarea
  6. 检查末尾是否添加了：
     "
     
     重要：请使用JSON格式返回结果。"

【步骤4】测试取消勾选功能
  1. 取消勾选 "☐ 启用 JSON Mode"
  2. 观察控制台输出：
  
  期待看到：
  ┌─────────────────────────────────────────┐
  │ 📝 module1-json 状态变更: 取消勾选     │
  │ 📄 当前 Prompt 长度: XXX 字符          │
  │ ❌ 已删除 JSON Mode 提示从             │
  │    module1-prompt                      │
  │ 📄 更新后 Prompt 长度: XXX 字符        │
  └─────────────────────────────────────────┘

  3. 检查 System Prompt 末尾的提示是否已删除

================================================
🔍 常见问题排查
================================================

【问题1】控制台没有初始化日志
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
可能原因：
  1. app.js 文件没有正确加载
  2. 浏览器缓存问题

解决方法：
  1. 按 Ctrl+Shift+R 强制刷新页面
  2. 检查 Console 是否有其他错误
  3. 确认 app.js 文件存在且完整

【问题2】看到错误 "❌ 未找到元素: module1-prompt"
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
可能原因：
  DOM 元素还没有加载完成

解决方法：
  1. 检查 index.html 中是否有 id="module1-prompt" 的元素
  2. 刷新页面重试
  3. 确认 HTML 文件完整

【问题3】勾选后没有反应
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
可能原因：
  1. 事件监听器没有绑定成功
  2. Prompt 中已经包含 JSON 格式说明

调试方法：
  1. 查看控制台是否有日志输出
  2. 如果看到 "ℹ️ Prompt 中已包含 JSON 格式说明"
     → 说明功能正常，只是检测到已有说明
  3. 尝试清空 Prompt，重新测试

【问题4】提示添加了，但看不到
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
可能原因：
  textarea 没有滚动到底部

解决方法：
  1. 向下滚动 textarea 查看末尾
  2. 或者查看控制台的 Prompt 长度变化
     （应该增加了约 20 个字符）

【问题5】功能在某个模块不工作
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
可能原因：
  该模块的 HTML 元素 ID 不正确

检查方法：
  1. 按 F12 打开开发者工具
  2. 切换到 "Elements" 标签
  3. 按 Ctrl+F 搜索 "module1-prompt"
  4. 确认元素存在

================================================
🧪 手动测试脚本
================================================

如果功能完全不工作，可以在控制台手动测试：

【测试1】检查元素是否存在
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
在控制台输入：

document.getElementById('module1-prompt')

期待结果：
  应该返回 <textarea> 元素，而不是 null

【测试2】检查函数是否定义
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
在控制台输入：

typeof setupJsonModeAutoHint

期待结果：
  应该返回 "function"

【测试3】手动触发功能
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
在控制台输入：

const textarea = document.getElementById('module1-prompt');
const originalValue = textarea.value;
textarea.value = originalValue + '\n\n重要：请使用JSON格式返回结果。';
console.log('手动添加成功！');

然后查看 textarea 是否有变化

【测试4】检查事件监听器
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
在控制台输入：

const checkbox = document.getElementById('module1-json');
checkbox.addEventListener('change', () => {
    console.log('复选框被点击！状态:', checkbox.checked);
});

然后尝试勾选/取消勾选，看是否有日志输出

================================================
📞 如果问题依然存在
================================================

请提供以下信息：

1. 浏览器版本（Chrome/Firefox/Edge等）
2. 控制台的完整日志（截图或复制）
3. 是否看到任何错误消息
4. 勾选复选框时是否有任何反应

可能的解决方案：

【方案A】清除缓存
  1. Ctrl+Shift+Delete 打开清除缓存对话框
  2. 清除缓存和Cookie
  3. 刷新页面

【方案B】检查文件完整性
  确认以下文件存在且完整：
  ✓ index.html
  ✓ app.js
  ✓ style.css

【方案C】使用备用方案
  如果自动功能不工作，可以手动添加：
  在 System Prompt 末尾手动添加：
  "
  
  重要：请使用JSON格式返回结果。"

================================================
✅ 成功标志
================================================

功能正常工作时，你应该看到：

1. ✅ 控制台有完整的初始化日志
2. ✅ 勾选时 Prompt 自动增加提示
3. ✅ 取消时 Prompt 自动删除提示
4. ✅ 每次操作都有详细的日志输出
5. ✅ Prompt 长度数字有变化

示例日志流程：
┌─────────────────────────────────────────┐
│ 初始化 → 绑定成功 → 勾选 → 添加成功    │
│          ↓                               │
│        取消勾选 → 删除成功               │
└─────────────────────────────────────────┘

================================================

祝测试顺利！如有问题，欢迎反馈。🚀


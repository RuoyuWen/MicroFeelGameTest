# 玩家记忆系统使用说明

## 📚 目录

- [系统介绍](#系统介绍)
- [快速开始](#快速开始)
- [配置Memory Module](#配置memory-module)
- [使用记忆系统](#使用记忆系统)
- [查看和管理记忆](#查看和管理记忆)
- [记忆数据说明](#记忆数据说明)
- [最佳实践](#最佳实践)
- [常见问题](#常见问题)

---

## 系统介绍

### 🎯 什么是玩家记忆系统？

玩家记忆系统是一个**智能的、跨session持久化**的记忆管理系统，它能够：

- ✅ **自动记录玩家信息**：名字、职业、外貌、性格、背景
- ✅ **追踪NPC关系**：与每个NPC的关系类型和信任度
- ✅ **记录目标和承诺**：玩家的目标、做出的承诺及完成状态
- ✅ **保存重要事件**：关键的故事发展和转折点
- ✅ **记录物品和技能**：玩家提到的装备和能力
- ✅ **存储发现的秘密**：玩家发现的线索和隐藏信息
- ✅ **持久化存储**：关闭浏览器后依然保留，下次继续使用

### 🌟 核心特性

1. **AI自动维护**：由专门的Memory Module分析对话，自动提取和更新关键信息
2. **跨session保存**：使用localStorage持久化，关闭浏览器后依然存在
3. **智能上下文**：在每次对话中自动提供记忆摘要给AI
4. **可视化管理**：通过友好的界面查看、导出、清空记忆
5. **灵活配置**：Memory Module的System Prompt可以自定义

---

## 快速开始

### Step 1: 启动系统

1. 打开系统，进入配置页面
2. 输入OpenAI API Key
3. 选择模型（推荐GPT-4o或GPT-4o-mini）

### Step 2: 配置Memory Module

找到**Module 4: 记忆模块 🧠**部分：

```
System Prompt: [已有默认配置]
☑ 启用记忆系统
```

**默认配置已经可以直接使用**，无需修改！

### Step 3: 开始游戏

1. 点击"开始"按钮
2. 填写场景信息并开始对话
3. 记忆系统会在后台自动工作

### Step 4: 查看记忆

在对话页面，点击右上角的**📋 查看玩家记忆**按钮即可查看当前记忆。

---

## 配置Memory Module

### 默认System Prompt

系统已经提供了一个默认的System Prompt：

```
你是一个智能记忆管理助手，负责维护玩家的记忆档案。

你的任务是分析玩家和NPC的对话，提取关键信息并更新玩家记忆。

提取的信息类型：
1. 玩家信息（名字、职业、外貌、性格、背景）
2. 与NPC的关系变化（互动、信任度1-10）
3. 目标和承诺（玩家的目标、做出的承诺）
4. 重要事件（关键的故事发展）
5. 物品和技能（装备、能力）
6. 秘密线索（发现的隐藏信息）

原则：
- 只记录明确提到的内容，不杜撰
- 新增而不是覆盖已有信息（除非明确更新）
- 保持客观，不添加主观解释
- 返回JSON格式的更新指令
```

### 自定义System Prompt

如果你想调整记忆系统的行为，可以修改System Prompt。例如：

**强调某些信息类型**：
```
你是一个记忆管理助手。特别注意：
1. 玩家与NPC的情感变化
2. 玩家的道德选择（善良/邪恶）
3. 战斗相关的技能和装备
...
```

**调整记录风格**：
```
你是一个记忆管理助手。记录风格：
- 保持简洁，每项不超过50字
- 使用第一人称视角记录
- 突出情感和氛围
...
```

### 启用/禁用记忆系统

可以通过勾选框控制：
- ☑ **启用记忆系统**：每次对话后自动更新记忆
- ☐ **禁用记忆系统**：不使用记忆功能（节省API调用）

---

## 使用记忆系统

### 记忆系统如何工作？

```
┌─────────────┐
│ 玩家发送消息 │
└──────┬──────┘
       │
       ▼
┌─────────────────────────┐
│ 对话模块生成NPC回应     │
│ (包含玩家记忆上下文)    │
└──────┬──────────────────┘
       │
       ▼
┌─────────────────────────┐
│ 显示对话                │
└──────┬──────────────────┘
       │
       ▼
┌─────────────────────────┐
│ Memory Module分析对话   │
│ 提取关键信息            │
└──────┬──────────────────┘
       │
       ▼
┌─────────────────────────┐
│ 更新玩家记忆变量        │
└──────┬──────────────────┘
       │
       ▼
┌─────────────────────────┐
│ 保存到localStorage      │
└─────────────────────────┘
```

### 记忆在对话中的使用

在每次对话时，系统会自动生成一个"记忆摘要"，包含：

```
【玩家记忆档案】
玩家信息：艾伦 - 年轻的冒险者，身穿皮甲
性格：勇敢、正直

与NPC的关系：
- 战士杰克：盟友（信任度9/10）
- 老板汤姆：友好（信任度7/10）

当前目标和承诺：
- 目标：找到失踪的妹妹
- 承诺：给杰克100金币

已发现的线索：
黑暗森林深处有神殿、老板知道魔物秘密
```

这个摘要会作为上下文提供给对话模块，让NPC能够：
- 记得玩家的名字 ✅
- 根据关系深度调整态度 ✅
- 引用之前的承诺和目标 ✅
- 使用玩家发现的线索 ✅

### 示例对话

#### ❌ 没有记忆系统

```
第一幕：
玩家："我叫艾伦，是个冒险者。"
NPC："欢迎！"

第二幕（几天后）：
玩家："还记得我吗？"
NPC："你是？" ❌ 忘记了
```

#### ✅ 有记忆系统

```
第一幕：
玩家："我叫艾伦，是个冒险者。"
NPC："欢迎，艾伦！"
[记忆系统：玩家名字=艾伦]

第二幕（几天后）：
玩家："还记得我吗？"
NPC："当然，艾伦！上次你说要找妹妹。" ✅ 完美记忆
```

---

## 查看和管理记忆

### 查看记忆

1. 在对话页面，点击右上角的**📋 查看玩家记忆**按钮
2. 记忆模态框会弹出，显示所有记忆数据

### 记忆界面说明

记忆界面分为多个部分：

#### 📋 玩家信息
- 名字、描述、性格、背景

#### 🤝 NPC关系
- NPC名字
- 关系类型（友好/敌对/中立/盟友）
- 信任度（1-10分）
- 关键互动记录

#### 🎯 目标与承诺
- 状态图标：◆ 进行中 | ✅ 已完成 | ❌ 失败
- 类型：目标或承诺
- 内容描述
- 相关NPC

#### 💡 关键事实
- 玩家表现出的关键信息
- 发生的场景

#### ⭐ 重要事件
- 关键的故事发展
- 对故事的影响

#### 🎒 物品
- 玩家提到的物品

#### ⚔️ 技能与能力
- 玩家展现的技能

#### 🔍 已发现的秘密
- 玩家发现的线索

### 导出记忆

1. 点击**📥 导出**按钮
2. 系统会下载一个JSON文件：`player_memory_2025-10-16.json`
3. 可以保存为备份或分享给其他人

### 清空记忆

1. 点击**🗑️ 清空记忆**按钮
2. 确认后，所有记忆将被删除
3. ⚠️ **此操作不可撤销！**

---

## 记忆数据说明

### 数据结构

记忆数据是一个JSON对象，包含以下字段：

```json
{
  "player_info": {
    "name": "玩家名字",
    "description": "玩家描述",
    "personality": "性格特征",
    "background": "背景故事"
  },
  "key_facts": [
    {
      "fact": "关键事实",
      "scene": "场景",
      "timestamp": "时间戳"
    }
  ],
  "relationships": {
    "NPC名字": {
      "relationship": "关系类型",
      "trust_level": 8,
      "key_interactions": ["互动1", "互动2"]
    }
  },
  "goals_and_promises": [
    {
      "type": "goal",
      "content": "找到妹妹",
      "related_npc": null,
      "status": "active",
      "scene": "第一幕"
    }
  ],
  "important_events": [
    {
      "event": "击败黑暗魔物",
      "scene": "第二幕",
      "impact": "获得村民信任"
    }
  ],
  "inventory_mentions": ["祖传宝剑", "魔法药水"],
  "skills_and_abilities": ["剑术", "基础魔法"],
  "secrets_discovered": ["森林深处有神殿"]
}
```

### 字段说明

#### player_info（玩家信息）
- **name**: 玩家的名字
- **description**: 外貌、职业等描述
- **personality**: 性格特征
- **background**: 背景故事

#### key_facts（关键事实）
- **fact**: 事实内容
- **scene**: 发生的场景
- **timestamp**: 记录时间

#### relationships（NPC关系）
- **relationship**: 关系类型（友好、敌对、中立、盟友等）
- **trust_level**: 信任度（1-10）
- **key_interactions**: 互动记录数组

#### goals_and_promises（目标和承诺）
- **type**: "goal"（目标）或"promise"（承诺）
- **content**: 内容描述
- **related_npc**: 相关的NPC
- **status**: "active"（进行中）、"completed"（已完成）、"failed"（失败）
- **scene**: 提出的场景

#### important_events（重要事件）
- **event**: 事件描述
- **scene**: 发生的场景
- **impact**: 对故事的影响

#### 其他字段
- **inventory_mentions**: 物品数组
- **skills_and_abilities**: 技能数组
- **secrets_discovered**: 秘密数组

---

## 最佳实践

### 1. 充分利用记忆系统

#### 明确介绍自己
```
玩家："我叫艾伦，是一名来自北方的战士，擅长剑术。"
```
✅ 记忆系统会记录：名字、职业、来源、技能

#### 建立关系
```
玩家："杰克，感谢你的帮助，你是我的好兄弟。"
```
✅ 记忆系统会更新：与杰克的关系为"盟友"，信任度提升

#### 设定目标
```
玩家："我一定要找到失踪的妹妹，这是我的使命。"
```
✅ 记忆系统会记录：目标=找到妹妹，状态=进行中

#### 做出承诺
```
玩家："如果你们帮我，我承诺事成后每人给100金币。"
```
✅ 记忆系统会记录：承诺=给100金币，相关NPC=当前对话的NPC

#### 记录发现
```
玩家："我发现了一个秘密入口，看起来通向地下。"
```
✅ 记忆系统会记录：秘密=发现秘密入口

### 2. 测试记忆系统

#### 测试名字记忆
```
第一轮：
玩家："我叫艾伦。"

第三轮：
玩家："你还记得我的名字吗？"
NPC："当然，艾伦。" ✅ 成功
```

#### 测试承诺记忆
```
第一幕：
玩家："我答应给你100金币。"

第五幕：
玩家："任务完成了！"
NPC："别忘了你承诺的100金币。" ✅ 成功
```

#### 测试关系记忆
```
玩家："我和杰克并肩作战过。"
NPC："既然你是杰克的朋友，我也信任你。" ✅ 成功
```

### 3. 管理记忆数据

#### 定期查看
- 每个场景结束后查看记忆
- 确认AI正确理解了关键信息

#### 适时导出
- 重要的冒险进度导出备份
- 分享给朋友一起体验

#### 合理清空
- 开始全新的故事时清空记忆
- 避免不同故事的记忆混淆

### 4. 优化记忆效果

#### 明确的表述
❌ "我挺厉害的"
✅ "我擅长剑术和火系魔法"

#### 重要信息重复
```
玩家："记住，我的妹妹叫莉莉，她失踪了三个月。"
```
重要信息可以多次提及，加深记忆

#### 使用NPC名字
❌ "你能帮我吗？"
✅ "杰克，你能帮我吗？"

使用名字可以让AI更好地追踪关系

---

## 常见问题

### Q1: 记忆系统会自动工作吗？

**A**: 是的！只要启用了记忆系统，它会在每次对话后自动分析和更新。你不需要做任何额外操作。

### Q2: 记忆会占用多少存储空间？

**A**: localStorage通常有5MB限制。一般的游戏记忆数据只占几十KB，足够使用。如果担心，可以定期导出并清空旧记忆。

### Q3: 关闭浏览器后记忆还在吗？

**A**: 是的！记忆保存在localStorage中，只要不清空浏览器数据，记忆会永久保存。

### Q4: 可以导入别人的记忆吗？

**A**: 目前还不支持导入功能，但你可以导出记忆文件保存或分享。未来版本会添加导入功能。

### Q5: 记忆更新失败怎么办？

**A**: 记忆更新失败不会影响对话继续，只是本轮对话的信息不会被记录。失败原因可能是：
- API调用出错
- Memory Module的System Prompt配置有问题
- 网络问题

检查浏览器控制台（F12）查看详细错误信息。

### Q6: 记忆系统会增加多少成本？

**A**: 每次对话会额外调用一次Memory Module，大约增加500-1000 tokens。以GPT-4o-mini为例：
- 无记忆：~$0.00005/次
- 有记忆：~$0.00017/次

增加成本约$0.00012/次，基本可以忽略。

### Q7: 记忆信息不准确怎么办？

**A**: 可能的原因和解决方法：
1. **AI理解错误**：尝试更明确地表述
2. **System Prompt需要调整**：修改Memory Module的prompt
3. **信息冲突**：清空记忆重新开始

### Q8: 可以手动编辑记忆吗？

**A**: 当前版本不支持直接编辑。如果需要修改记忆：
1. 导出记忆JSON文件
2. 用文本编辑器修改
3. 等待未来版本的导入功能

或者通过对话让AI更新记忆：
```
玩家："我想更正一下，我的妹妹叫莉莉，不是露娜。"
```

### Q9: 记忆系统支持多个存档吗？

**A**: 当前版本只支持一个存档（localStorage中的单个记忆）。如果想要多个存档：
1. 导出当前记忆
2. 清空记忆
3. 开始新游戏

### Q10: 记忆太多会影响性能吗？

**A**: 记忆过多可能导致：
- localStorage接近容量限制
- 记忆上下文过长，消耗更多tokens

建议：
- 定期清理不重要的记忆（手动导出后清空）
- 每个类别的数据已有数量限制（如关键事实最多50条）

---

## 💡 使用技巧

### 角色扮演技巧

1. **在第一次对话中介绍自己**
   ```
   "我叫艾伦，是一名战士，来自北方的小村庄。"
   ```

2. **主动提及目标和动机**
   ```
   "我来这里是为了寻找失踪的妹妹。"
   ```

3. **建立与NPC的关系**
   ```
   "杰克，我们并肩作战过，我信任你。"
   ```

4. **记录重要承诺**
   ```
   "我承诺，如果你帮我，我会给你100金币。"
   ```

5. **留意发现的线索**
   ```
   "我注意到森林深处有一座神殿。"
   ```

### 故事连贯性技巧

1. **引用之前的对话**
   ```
   "你之前说的那个线索，能详细说说吗？"
   ```

2. **测试NPC记忆**
   ```
   "你还记得我叫什么吗？"
   "我们之前达成的协议，你记得吗？"
   ```

3. **建立长期关系**
   ```
   第一幕："初次见面，多多关照。"
   第五幕："老朋友，又见面了。"
   ```

---

## 🎉 享受游戏

有了玩家记忆系统，你的AI RPG体验将会：

- ✅ 更加真实和沉浸
- ✅ NPC能记住你的选择和行为
- ✅ 故事发展更加连贯
- ✅ 角色关系更加深入
- ✅ 跨多次游戏session保持连续性

**开始你的冒险吧！** 🎮✨

---

## 📞 技术支持

如果遇到问题：
1. 检查浏览器控制台（F12 → Console）
2. 查看详细错误信息
3. 参考本文档的常见问题部分

**祝游戏愉快！** 🎊


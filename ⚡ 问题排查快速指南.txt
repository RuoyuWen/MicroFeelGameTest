================================================
⚡ JSON Mode 功能问题排查 - 快速指南
================================================

如果 JSON Mode 自动提示功能没有工作，请按照以下步骤操作：

================================================
🚀 快速步骤（推荐）
================================================

【第一步】强制刷新浏览器
  按 Ctrl+Shift+R（或 Cmd+Shift+R）
  ↓
  这会清除缓存并重新加载所有文件

【第二步】打开浏览器控制台
  按 F12
  ↓
  切换到 "Console" 标签

【第三步】查看初始化日志
  
  应该看到：
  ┌─────────────────────────────────────┐
  │ ✅ 从 localStorage 加载玩家记忆     │
  │ 🔧 正在初始化 JSON Mode 自动提示... │
  │ ✅ 已绑定 JSON Mode 自动提示: ...  │
  │ ✅ JSON Mode 自动提示已启用         │
  └─────────────────────────────────────┘

  ✅ 看到这些 → 功能已启用，继续第四步
  ❌ 没看到 → 跳到"深度诊断"部分

【第四步】测试功能
  1. 在配置页面找到 "Module 1: 对话模块"
  2. 勾选 "☑ 启用 JSON Mode"
  3. 查看控制台，应该看到：
     "📝 module1-json 状态变更: 勾选"
  4. 向下滚动 System Prompt 的文本框
  5. 检查末尾是否出现：
     "
     
     重要：请使用JSON格式返回结果。"

  ✅ 出现了 → 功能正常工作！
  ❌ 没出现 → 继续"深度诊断"

================================================
🔍 深度诊断（如果快速步骤失败）
================================================

使用自动诊断脚本：

【步骤1】打开 index.html
【步骤2】按 F12 打开控制台
【步骤3】打开文件 "诊断脚本.js"
【步骤4】复制整个文件内容
【步骤5】粘贴到控制台，按 Enter

脚本会自动检查：
  ✓ HTML 元素是否存在
  ✓ 函数是否定义
  ✓ 事件监听器是否工作
  ✓ 添加/删除功能是否正常

然后告诉你问题所在！

================================================
📖 详细文档
================================================

如果还有问题，查看：
  "🔧 JSON_Mode功能测试指南.txt"
  ↑ 包含详细的测试步骤和故障排除

================================================
💡 常见原因和解决方案
================================================

【原因1】浏览器缓存
  解决：Ctrl+Shift+R 强制刷新

【原因2】文件未完全加载
  解决：等待几秒，刷新页面

【原因3】已经包含 JSON 说明
  现象：控制台显示 "ℹ️ 已包含 JSON 格式说明"
  说明：功能正常，只是检测到已有说明

【原因4】JavaScript 错误
  检查：控制台是否有红色错误消息
  解决：查看错误详情

================================================
🆘 手动添加（备用方案）
================================================

如果自动功能完全不工作，可以手动操作：

在 System Prompt 末尾添加：

重要：请使用JSON格式返回结果。

（前面加两个空行）

================================================
✅ 成功的标志
================================================

功能正常时，你会看到：

1. ✅ 控制台有 "✅ JSON Mode 自动提示已启用"
2. ✅ 勾选复选框时有日志输出
3. ✅ Prompt 末尾自动出现提示文本
4. ✅ 取消勾选时提示自动消失
5. ✅ 每次操作都有详细日志

================================================

还有问题？查看详细文档或使用诊断脚本！🚀

